
(library
  (public_name why3gospel)
  (flags :standard -w -9-32-27 -linkall)
  (modules why3gospel_trans why3gospel)
  (libraries why3 gospel))

;; cf https://discuss.ocaml.org/t/dune-problems-using-dynlink-plugins/2874
(rule
  (targets real_why3gospel.cmxs)
  (deps remove.c why3gospel.cmxa ../gospel/ocaml-lib/gospel.cmxa)
  (action (run ocamlfind ocamlopt -verbose
                  -shared
                  -linkall
                  -linkpkg
                  ;; -dontlink compiler-libs.common
                  -package ocaml-compiler-libs.common
                  %{deps}
                  -o %{targets}
  )))

(install
  (section lib_root)
  (files
   (real_why3gospel.cmxs as why3/plugins/real_why3gospel.cmxs))
  (package why3gospel))

;; (install
;;   (section lib_root)
;;   (files
;;    (why3gospel.cmxs as why3/plugins/why3gospel.cmxs))
;;   (package why3gospel))
